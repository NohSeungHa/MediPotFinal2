<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="hospital">

	<resultMap type="doctorInfos" id="doctorInfosMap">
		<result column="professional" property="professional" typeHandler="StringArray"/>
	</resultMap>

	<select id="checkId" parameterType="string" resultType="_int">
		select count(*) from hospital where hospitalId=#{hospitalId}
	</select>
	
	<insert id="insertHospital" parameterType="hospital">
		insert into hospital values(
			hospital_seq.nextval,
			#{hospitalId},
			#{hospitalPw},
			#{hospitalName},
			#{hospitalLicense},
			#{hospitalReLicense},
			#{hospitalTel},
			#{hospitalEmail},
			#{hospitalAddr},
			sysdate,
			#{hospitalLike},
			0,
			#{hospitalProfessional}
		)
	</insert>
	
	<select id="loginCheck" parameterType="string" resultType="hospital">
		select * from hospital where hospitalId=#{memberId}
	</select>
	
	<select id="selectHospitalList" resultType="hospital">
		select A.* from hospital A order by hospitalDate DESC
	</select>
	
	<select id="selectCount" resultType="_int">
 		select count(*) from hospital
 	</select>
 	
 	<update id="updateAdmission">
 		update hospital set hospitalAdmission=1 where hospitalNum=#{hospitalNum}
 	</update>

	<select id="checkhospitalEmail" parameterType="string" resultType="_int">
		select count(*) from hospital where hospitalEmail=#{HospitalEmail}
	</select>

	<select id="hoscnt" resultType="_int">
		select count(*) from hospital where hospitalAdmission=0
	</select>
	
	<select id="EmailCheck" parameterType="string" resultType="_int">
		select count(*) from hospital where hospitalEmail=#{hospitalEmail}
	</select>
	
	<select id="hospitalNameinput" parameterType="_int" resultType="string">
		select hospitalName from hospital where hospitalNum=#{hospitalNum}
	</select>
	
	<select id="selectHospital" parameterType="_int" resultType="hospital">
		select * from hospital where hospitalNum=#{hospitalNum}
	</select>
	
	<update id="hospitalUpdate" parameterType="hospital">
		update hospital set
			hospitalName=#{hospitalName},
			hospitalTel=#{hospitalTel},
			hospitalLicense=#{hospitalLicense},
			hospitalReLicense=#{hospitalReLicense},
			hospitalAddr=#{hospitalAddr}
		where hospitalNum=#{hospitalNum}
	</update>
	
	<insert id="hospitalInfoinsert" parameterType="hospitalInfos">
		INSERT INTO HOSPITALINFO values(
			#{hospitalInfoNum},
			#{hospitalInfoIntro},
			#{hospitalInfoNotice},
			#{hospitalPhoto},
			#{hospitalRePhoto},
			#{hospitalInfoUsetime},
			#{hospitalInfoLunchtime}
		)
	</insert>
	
	<select id="selectHospitalInfo" parameterType="_int" resultType="hospitalInfos">
		select * from hospitalInfo where hospitalInfoNum=#{hospitalNum}
	</select>
	
	<select id="loadHospitalInfo" parameterType="_int" resultType="_int">
		select count(*) from hospitalInfo where hospitalInfoNum=#{hospitalNum}
	</select>
	
	<update id="updateHospitalInfo" parameterType="hospitalInfos">
		update hospitalInfo set 
			hospitalInfoIntro=#{hospitalInfoIntro},
			hospitalInfoNotice=#{hospitalInfoNotice},
			hospitalPhoto=#{hospitalPhoto},
			hospitalRePhoto=#{hospitalRePhoto},
			hospitalInfoUsetime=#{hospitalInfoUsetime},
			hospitalInfoLunchtime=#{hospitalInfoLunchtime}
		where hospitalInfoNum=#{hospitalInfoNum}
	</update>
	
	<select id="selectDoctorInfo" parameterType="_int" resultType="doctorInfos">
		select * from doctorInfo where hospitalNo=#{hospitalNum}
	</select>
	
	<insert id="doctorinfoinsert" parameterType="doctorInfos">
		insert into doctorInfo values(
			doctorinfo_seq.nextval,
			#{doctorName},
			#{doctorCareer},
			#{hospitalNo},
			#{professional, typeHandler=StringArray},
			#{doctorSlunch},
			#{doctorElunch},
			#{weekdayStime},
			#{weekdayEtime},
			#{satStime},
			#{satEtime},
			#{closed},
			#{specialized},
			#{doctorPhoto},
			#{doctorRePhoto},
			#{timeInterval}
		)
	</insert>
	
	<select id="selectDoctorPhoto" parameterType="_int" resultType="doctorInfos">
		select * from doctorInfo where doctorNum=#{doctorNum}
	</select>
	
	<select id="DoctorsProfessional" parameterType="_int" resultType="string">
		select professional from doctorInfo where doctorNum=#{doctorNum}
	</select>
	
	<update id="updateDoctorInfo" parameterType="doctorInfos">
		update doctorInfo set
			doctorCareer=#{doctorCareer},
			professional=#{professional, typeHandler=StringArray},
			doctorSlunch=#{doctorSlunch},
			doctorElunch=#{doctorElunch},
			weekdayStime=#{weekdayStime},
			weekdayEtime=#{weekdayEtime},
			satStime=#{satStime},
			satEtime=#{satEtime},
			closed=#{closed},
			specialized=#{specialized},
			doctorPhoto=#{doctorPhoto},
			doctorRePhoto=#{doctorRePhoto},
			timeInterval=#{timeInterval}
		where doctorNum=#{doctorNum}
	</update>
	
	<select id="HospitalFindId" parameterType="hospital" resultType="string">
		select rpad(substr(hospitalId,1,4),length(hospitalId),'*') from hospital where hospitalName=#{hospitalName} and hospitalEmail=#{hospitalEmail}
	</select>
	
	<select id="searchHospitalName" parameterType="string" resultType="hospital">
		select * from hospital where hospitalName=#{hospitalName}
	</select>
	
	<select id="hospitalNameDoctorNum" parameterType="_int" resultType="string">
		select hospitalName from hospital where hospitalNum=(select hospitalNo from doctorInfo where doctorNum=#{doctorNum})
	</select>
	
	<select id="selectFindHospital" parameterType="string" resultType="hospital">
		select * from hospital where hospitalId=#{hospitalId}
	</select>
	
	<delete id="deleteDoctors" parameterType="_int">
		delete from doctorInfo where hospitalNo=#{hospitalNo}
	</delete>
	
	<delete id="deleteHospitalInfo" parameterType="_int">
		delete from hospitalInfo where hospitalInfoNum=#{hospitalInfoNum}
	</delete>
	
	<update id="updateHospital">
		update hospital set
			hospitalId='탈퇴한 아이디',
			hospitalName='탈퇴한 병원',
			hospitalEmail='탈퇴한 이메일',
			hospitalAddr='탈퇴한 주소'
		where hospitalNum=#{hospitalNum}
	</update>
</mapper>
